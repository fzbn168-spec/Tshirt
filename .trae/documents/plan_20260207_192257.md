# 阶段二：销售赋能 (CRM 基础版) 开发计划

本阶段旨在实现基础的客户关系管理 (CRM) 功能，使平台管理员（或销售代表）能够认领和管理自己的客户企业。

## 1. 数据库架构变更

* **修改** **`Company`** **模型**:

  * 增加字段 `salesRepId` (String?, 可选).

  * 增加关联 `salesRep` (关联到 User 模型).

* **修改** **`User`** **模型**:

  * 增加关联 `managedCompanies` (反向关联 Company).

* **目的**: 建立“一个业务员对应多个客户企业”的关系。

## 2. 后端开发 (NestJS)

* **更新** **`PlatformService`**:

  * 升级 `findAllCompanies` 方法，支持返回 `salesRep` 信息，并支持按 `salesRepId` 筛选。

  * 新增 `findAllSalesReps` 方法，获取所有具备平台权限的用户（潜在的业务员）。

  * 新增 `assignSalesRep(companyId, salesRepId)` 方法，用于分配客户。

* **更新** **`PlatformController`**:

  * `GET /platform/companies`: 增加 `?salesRepId=` 查询参数。

  * `GET /platform/sales-reps`: 新增接口，返回业务员列表。

  * `PATCH /platform/companies/:id/sales-rep`: 新增接口，用于分配业务员。

## 3. 前端开发 (Next.js)

* **更新企业管理页 (`/admin/companies`)**:

  * **筛选栏**: 新增 "My Customers" (仅看我的客户) 切换开关，以及 "Sales Rep" 下拉筛选。

  * **数据表格**: 新增 "Sales Rep" 列，显示当前负责的业务员。

  * **分配操作**: 在 "Sales Rep" 列直接嵌入下拉菜单 (Select)，允许管理员快速重新分配客户。

## 4. 执行步骤

1. 修改 `schema.prisma` 并执行数据库迁移。
2. 更新后端 Service 和 Controller 逻辑。
3. 更新前端页面 UI 和交互逻辑。
4. 验证：分配业务员后，筛选功能是否生效。

