# B2B 鞋服独立站功能开发进度评估与下一步计划

经过对代码库 (`d:\网站`) 的深度扫描与需求清单 (`B2B_Shoe_Apparel_Requirements.md`) 的比对，以下是当前的技术栈状态与功能完成度分析。

## 1. 技术栈状态

* **前端**: Next.js 16 (App Router), TypeScript, Tailwind CSS, Zustand (状态管理), next-intl (国际化).

* **后端**: NestJS, Prisma (ORM), SQLite (Dev DB).

* **核心服务**: PDFKit (单证生成), Nodemailer (邮件通知), Multer (文件上传).

## 2. 功能完成度分析

### ✅ 已完成的核心模块 (P0 - 关键业务闭环)

| 模块     | 功能点            | 状态   | 说明                           |
| :----- | :------------- | :--- | :--------------------------- |
| **前台** | 多语言/i18n       | ✅ 完成 | 支持中英切换，已集成 next-intl         |
| **前台** | SKU 矩阵详情页      | ✅ 完成 | `SkuSelector` 支持颜色/尺码/属性动态组合 |
| **前台** | 阶梯价格           | ✅ 完成 | 支持根据购买数量动态计算单价               |
| **前台** | 询价车 (RFQ Cart) | ✅ 完成 | 类似购物车的批量询价流程已跑通              |
| **前台** | 用户系统           | ✅ 完成 | 企业注册、登录、自动关联公司逻辑已就绪          |
| **中台** | 询价/订单管理        | ✅ 完成 | 买家查看历史、管理员报价 (生成 PDF)、订单状态流转 |
| **后台** | SPU/SKU 管理     | ✅ 完成 | 支持复杂的属性变体创建与管理               |
| **后台** | 企业审核           | ✅ 完成 | 管理员可审核注册企业资质                 |

### 🚧 待完善/开发中的模块 (P1 - 运营与体验增强)

| 模块     | 功能点             | 状态    | 缺失点/待办                          |
| :----- | :-------------- | :---- | :------------------------------ |
| **前台** | **游客访问限制**      | ⏳ 待开发 | 目前未登录用户仍可见价格，需增加权限控制 (B2B 核心需求) |
| **中台** | **在线沟通**        | ⏳ 待开发 | 目前仅支持静态备注 (Notes)，缺少即时协商/留言板功能  |
| **后台** | **CRM (公海/私海)** | ⏳ 待开发 | 缺少销售人员分配逻辑，目前所有管理员都能看所有客户       |
| **后台** | 库存/货期管理         | ⚠️ 部分 | 数据库有字段，但前端缺少库存预警和交货期展示          |

### ❌ 未开始的模块 (P2 - 锦上添花)

* **样册下载**: 产品目录 PDF 自动生成与下载。

* **返单功能**: 基于历史订单一键重新下单。

* **运费模板**: 复杂的自动运费计算逻辑。

## 3. 下一步操作建议 (Next Steps)

基于 B2B 业务的优先级，建议按以下顺序进行迭代：

### 阶段一：权限管控与信任感构建 (Priority: High)

**目标**：保护渠道价格体系，增强平台专业度。

1. **实现 \[游客访问限制]**:

   * 修改商品详情页与列表页，对未登录用户**隐藏价格**，显示 "Login to View Price"。

   * 这对 B2B 平台至关重要，防止价格透明化影响下游分销。
2. **优化 \[公司认证] 流程**:

   * 在企业中心增加 "认证状态" 显眼标识。

   * 未认证企业限制询价额度或不可查看大货价。

### 阶段二：销售赋能 (Priority: Medium)

**目标**：支持多业务员协作。

1. **开发 \[CRM 基础版]**:

   * 给 `Company` 表增加 `salesRepId` (归属业务员)。

   * 管理后台增加 "我的客户" 视图，业务员只能跟进自己的客户询盘。

### 阶段三：沟通效率 (Priority: Medium)

1. **开发 \[询盘留言板]**:

   * 在询价单详情页增加 "Messages" 模块，允许买卖双方针对该询价单进行对话记录。

***

### 🚀 立即执行建议

**建议优先完成 "游客访问限制 (Guest Access Control)"**。这是一个改动小但商业价值极高的功能。

如果您同意，我将开始执行 **阶段一：实现游客访问限制**，具体包括：

1. 修改 `ProductGrid` 和 `ProductInfo` 组件。
2. 判断用户登录状态 (Session/Token)。
3. 未登录时将价格替换为 "Login to View Price" 提示与登录链接。

