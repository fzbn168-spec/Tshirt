# 部署与发布流程计划

基于现有的 Docker 配置，我们将进行更加健壮的生产环境部署准备。当前的配置虽然可用，但更适合开发环境。我们将对其进行优化，使其适用于生产或准生产环境。

## 1. 优化 Docker 配置
- **后端 (Backend)**:
  - 优化 `Dockerfile`：使用多阶段构建 (Multi-stage build) 以减小镜像体积。
  - 确保 `Prisma` 客户端在生产环境中正确生成。
- **前端 (Frontend)**:
  - 优化 `Dockerfile`：同样使用多阶段构建，仅包含生产环境所需的构建产物 (`.next` 文件夹等)。
- **Docker Compose**:
  - 添加 `restart: always` 策略，确保服务崩溃后自动重启。
  - 配置 `nginx` 作为反向代理服务器，统一入口并处理静态资源（可选，但推荐）。暂时先保持简单，直接暴露端口，但需优化环境变量配置。

## 2. 环境变量管理
- 创建 `.env.production` 示例文件，列出所有必要的生产环境变量。
- 更新 `docker-compose.yml` 以使用 `.env` 文件。

## 3. 构建与启动脚本
- 编写 PowerShell 脚本 (`deploy.ps1`) 以自动化构建和启动流程：
  1. 停止旧容器。
  2. 重新构建镜像。
  3. 启动新容器。
  4. 运行数据库迁移（如果需要）。

## 4. 验证部署
- 部署后，检查服务健康状态。
- 验证前后端连接是否正常。

## 执行步骤
1.  **优化 Backend Dockerfile**: 修改为多阶段构建。
2.  **优化 Frontend Dockerfile**: 修改为多阶段构建。
3.  **更新 docker-compose.yml**: 增加生产环境配置（重启策略、网络等）。
4.  **创建 .env.example**: 记录生产环境所需变量。
5.  **编写 deploy.ps1**: 自动化部署脚本。
6.  **执行部署**: 运行脚本并验证。

准备好后，请确认此计划。